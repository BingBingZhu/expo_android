# 实景导航开发计划

## 开发模块时间规划

1. 绘制罗盘及其运动
2. 箭头导航
3. 标签展示及详情介绍
4. 2D切换
5. 导航信息展示
6. 关注点光团动作展示

### 问题

1. 罗盘实现
2. 箭头转弯实现
3. 播放模型动画？
4. 最终UI

### 提供内容制作标准格式

1. 模型动画格式
2. 转换工具使用

### 扩展性要求

1. 罗盘箭头样式能够更换
2. AR虚拟景观能更换


### 代码开发工具

1. 打包工具？


### 罗盘实现

1. 罗盘和箭头模型组合，罗盘贴图使用图片或是Canvas?
2. 箭头指向: 相对于罗盘模型，指向角度根据POI点
3. 组合模型组旋转变换根据手机传感器数据


### 导航箭头实现
1. 加载模型


### 模型格式支持

1. JSON
2. OBJ
3. Object: 不能加载Geometry,直接加载Mesh
4. OBJ与MTL， 加载模型并直接赋予材质
5. Collada: 定义场景、模型、动画
6. 

### 动画
1. 基础动画，render中修改属性，Tween.js
2. 移动相机
3. 变形蒙皮、骨骼动画
4. 加载外部动画
  1. Blender到出JSON文件，animation作为geometry的属性
  2. Collada模型加载动画
  3. 



2017/11/23
-----------

1. 箭头指向
2. 导航路线
3. 调用模型动画调控
4.      
 
 
---------
2017/12/04

AR 实景导航界面与终端接口说明

1. 获取当前位置 Java调JS
sendUserPosition(lng: number, lat: number)

2. 获取传感器数据 Java调JS
sendSensorData(azimuth: number, pitch: number, roll: number)

3. 获取目的地数据 JS调Java
@return json "{
  "name": "",
  "distance": "",
  "longitude": "",
  "latitude": "",
  "type": ""
}"
window.Terminal_Interface.getDestInfo()

4. 获取路线规划数据
@return json "{}"
window.Terminal_Interface.getPaths()

5. 通知终端调用JS的时机
@param {bool} true/false
window.Terminal_Interface.canCallJS()

6. 退出处理，点击back键，弹出确认框，点击*确认*直接退出，点击*取消*则阻止退出事件默认行为，留在实景导航页面

// 点击back键
function exitNav() {
  // 弹出确认框
  // 阻止退出默认事件
}


// 点击确定，触发退出事件
function confirmExitNav() {
  // 手动触发退出
  window.Terminal_Interface.finish()

}

--------
2017/12/05

1. 计算更新路线数据
2. 固定模型
3. 测试动画模型
4. 导航


----------
2017/12/07

1. 如何确定到达指定地点出现指定动作？根据范围大小，在范围内出现动作
2. 如何切换下一个关键点位置？
 


2017/12/08
----------
错误日志记录

1. sendSensorData not defined 时有时无， 异步，调用时间问题
2. 罗盘问题


2017/12/09
----------

问题
1. 罗盘旋转
2. 路线规划问题


改进
1. mobileTest分支去掉GUI调试
2. 梳理数据流程和调用时序


2017/12/11
---------

Q: 
1. 预览问题
2. 路线问题
3. 二维marker偏离问题




2017/12/12
---------

1. 初始图标加载问题
2. 当前marker更新
3. marker点偏移问题
4. 拐点处理问题
5. 声音问题

2017/12/13
----------


1. ~~开始action_01-出场问好~~
1. ~~直行action_02-飞行~~
1. ~~左转action_03~~
1. ~~右转action_04~~
1. ~~终点action_05-到达目的地~~
1. ~~退出action_06-用户中途退出~~
1. ~~信号弱action_07~~
1. ~~交互action_08 用户戳光团~~
1. 跟上
1. 停留过长
1. 介绍
1. 休息
1. 上厕所
1. 偏离路线
1. 




2017/12/15
---------

1. Uncaught ReferenceError: sendSensorData isn't defined
2. 


2017/12/16
--------

1. 地图POI数据来自后台管理界面上传
2. 修改实景界面动作调度实现
3. 光团动作固定实现
4. 修改模型展示手机端无法缩放和旋转问题
5. 


2017/12/17
----------

1. 后台管理界面上传模型删除修改问题
2. 修改UI，暂时不修改
3. 离开确定UI
4. 光团动作
5. 导航点上传

问题:

1. 模型上传问题
2. 离开问题
3. 数据处理问题
4.  

2017/12/18
----------

1. 添加园区问题
2. 模型上传问题
3. 模型缩放问题
4. 退出处理


上传模型问题描述：

1. 管理界面删除指定动作，比如action_01这个动作，服务器文件系统中的文件夹action_01并未删除
2. 重新添加action_01这个动作包(包中内容已更新)，服务器文件系统中的action_01文件夹中的内容并未更新
3. 添加某些动作包添加不了,比如action_05这个包(3d文件目录下没有action_05文件夹)


2017/12/18 PM 开会需求讨论

问题
1. 获取指定园区相关数据
2. 确定测试围栏 
3. 获取AR沙盘模型服务目录路径
4. 模型动画处理有问题
5. 

开发优先级

1. 截图
2. 测试GIF效果
3. 改gif动画实现, 替换src
4. 后退处理
5. UI改
6. 详情中点击“AR”弹出模型预览
7. 点击“到这去”跳转二维地图，然后进入三维地图
8. 改罗盘效果
9. 改沙盘预览
10. 可点击目的点UI处理


POI点
------

1. 116.33273,39.980287
2. 116.332741,39.981093
3. 116.333181,39.979539
4. 116.332988,39.978626
5. 116.332204,39.979769
6. 116.333975,39.978174
7. 116.332548,39.979818

围栏点：
1. 116.330649,39.977525
2. 116.334704,39.981734
3. 116.334704,39.977525
4. 116.330649,39.981734

http://lbs.amap.com/console/show/picker查看POI点位置


2017/12/19 PM 23.00

2017/12/20 
测试问题
1. ~~点击确定抛出Java异常 fixed~~
2. ~~动作时间问题~~
3. 第一次进入出现图片占位
4. 调整罗盘角度
5. 修改添加可点击目标点小手图标

2017/12/20 PM 5:00

测试发现问题


1. ~~二维地图当前点更新问题~~
2. 实景导航左转/右转问题， 调用转弯动作需要及时切换箭头指向
3. 到达终点抛出错误 action not property 437
4. ~~未到电子围栏触发错误（不能进行导航）~~
5. 动作先于箭头指向改变
6. 模型手机预览问题
7. 提前提示到达终点
8. ~~开始导航前箭头指向晚于动作~~


2017/12/21
--------

1. ~~百科详情，获取富文本接口~~
2. ~~场馆详情， 场馆数据详情~~
3. ~~修改实景导航bug~~

2017/12/21 PM 15:00

1. ~~修改可点击类型判断，是否有沙盘预览判断，那个字段？~~
2.~~ 修改获取数据逻辑~~
3. ~~updateArrowOrientation调用时序问题~~
4. 

2017/12/21 PM 18: 00

1. 创建标签需要重构
2. 模型预览需重构
3. 减少全局变量，优化代码结构，模块化

2017/12/21 PM 19：00

实际测试发现问题
1. ~~罗盘大小~~
2. ~~未到终点提示到达终点~~
3. ~~图片占位~~
4. ~~标签图层~~
5. ~~到达终点范围判断~~
6. ~~更改拐弯点播放次数~~

2017/12/22 AM 9:00

1. 推荐详情跳转二维地图
2. 搜索跳转二维地图


2017/12/22 PM 4:30

测试改进问题

1.  X 退出同样需要确认
2. 最后退出音频消失
3. 直行状态下点击光团会有动作动画


2017/12/25
---------

1. 添加地图点选中状态
1. 模型预览问题
1. IOS适配
1. 代码优化问题


2017/12/26


1. 退出
1. 集成iOS

2017/12/27
-----------

1. 集成
1. 添加动作
1. 修改UI

2017/12/28
----------

1. 集成
1. 添加信号弱动作提示


2017/1/2
-------

1. 地图页面加载当前园区数据时未获得数据
1. 搜索跳转地图页面
1. 实景导航文字提示过晚
1. 标签未动 


2017/1/5


1. 修改返回键位置top: 60px
1. 36px bold ,  
2. 


2017/1/10
----------

1. 实景页面去掉选择复制
1. 去掉拖动条
2. 修改UI细节
3. 退出键无效
4. 切换园区抛错
5. 导游界面资源加载优化问题（性能问题）

修改UI
1. 地图页面
  2. 文字大小
  3. Sh:1334，Bh:160修改高度
  4. 24px指示图标, 24px文字, #999


2017/1/11
-----------

1. 不同园区处理问题
2. 实景界面加载呈现先后问题
3. iOS集成问题


2017/1/18
--------

1.~~ 去这里场馆无路线规划~~
2. ios地图poi点时有时无
3. ios罗盘方位问题
4. 进入实景立马退出动画播放问题
5. 搜索或详情跳转存在没有路线规划情况
6. 

2017/1/22
---------

1. 